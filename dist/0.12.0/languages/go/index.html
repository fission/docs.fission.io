<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.37" />
    <meta name="description" content="Documentation for Fission">
<meta name="google-site-verification" content="5AvQfeDvIx0ldE9uSKVsoikqgFknd_CT18caf9TNoVg" />
<meta name="author" content="Fission">

    <link rel="shortcut icon" href=/0.12.0/images/favicon.png type="image/x-icon" />
<link rel="icon" href=/0.12.0/images/favicon.png type="image/x-icon" />

    <title>Using Go with Fission :: Serverless Functions for Kubernetes</title>
    
    
    <link href="/0.12.0/css/nucleus.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/font-awesome.min.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/hybrid.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/featherlight.min.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/perfect-scrollbar.min.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/auto-complete.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/theme.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/hugo-theme.css?1541109125" rel="stylesheet">
    
      <link href="/0.12.0/css/theme-fission.css?1541109125" rel="stylesheet">
    

    <script src="/0.12.0/js/jquery-2.x.min.js?1541109125"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/0.12.0/languages/go/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://fission.io/">
  <img src=/0.12.0/images/fission-logo.png>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="/0.12.0/js/lunr.min.js?1541109125"></script>
<script type="text/javascript" src="/0.12.0/js/auto-complete.js?1541109125"></script>
<script type="text/javascript">
    
        var baseurl = '\/0.12.0';
    
</script>
<script type="text/javascript" src="/0.12.0/js/search.js?1541109125"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/0.12.0/installation/" title="Installing Fission" class="dd-item 
        
        
        parent
        ">
      <a href="/0.12.0/installation/">
          Installing Fission
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/installation/kubernetessetup/" title="Kubernetes Quick Install" class="dd-item ">
        <a href="/0.12.0/installation/kubernetessetup/">
        Kubernetes Quick Install
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/0.12.0/installation/upgrade/" title="Upgrading Fission" class="dd-item 
        
        
        
        ">
      <a href="/0.12.0/installation/upgrade/">
          Upgrading Fission
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/installation/env_vars/" title="Environment Variables" class="dd-item ">
        <a href="/0.12.0/installation/env_vars/">
        Environment Variables
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.12.0/concepts/" title="Fission Concepts" class="dd-item 
        
        
        parent
        ">
      <a href="/0.12.0/concepts/">
          Fission Concepts
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/concepts/basic-concept/" title="Basic Concepts" class="dd-item ">
        <a href="/0.12.0/concepts/basic-concept/">
        Basic Concepts
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/concepts/executor/" title="Fission Function Executors" class="dd-item ">
        <a href="/0.12.0/concepts/executor/">
        Fission Function Executors
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.12.0/usage/" title="Using Fission" class="dd-item 
        
        
        parent
        ">
      <a href="/0.12.0/usage/">
          Using Fission
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/package/" title="Packaging source code" class="dd-item ">
        <a href="/0.12.0/usage/package/">
        Packaging source code
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/access-secret-cfgmap-in-function/" title="Accessing Secrets in Functions" class="dd-item ">
        <a href="/0.12.0/usage/access-secret-cfgmap-in-function/">
        Accessing Secrets in Functions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/environments/" title="Environments" class="dd-item ">
        <a href="/0.12.0/usage/environments/">
        Environments
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/functions/" title="Functions" class="dd-item ">
        <a href="/0.12.0/usage/functions/">
        Functions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/trigger/" title="Triggers" class="dd-item ">
        <a href="/0.12.0/usage/trigger/">
        Triggers
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/executor/" title="Controlling Function Execution" class="dd-item ">
        <a href="/0.12.0/usage/executor/">
        Controlling Function Execution
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/developer-workflow/" title="Source Code Organization and Your Development Workflow" class="dd-item ">
        <a href="/0.12.0/usage/developer-workflow/">
        Source Code Organization and Your Development Workflow
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/ingress-tutorial/" title="Exposing functions with Ingress" class="dd-item ">
        <a href="/0.12.0/usage/ingress-tutorial/">
        Exposing functions with Ingress
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/canary-deployments/" title="Supporting Canary Deployments for Fission Functions" class="dd-item ">
        <a href="/0.12.0/usage/canary-deployments/">
        Supporting Canary Deployments for Fission Functions
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.12.0/languages/" title="Languages" class="dd-item 
        parent
        
        parent
        ">
      <a href="/0.12.0/languages/">
          Languages
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/languages/nodejs/" title="Fission functions with Nodejs" class="dd-item ">
        <a href="/0.12.0/languages/nodejs/">
        Fission functions with Nodejs
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/languages/go/" title="Using Go with Fission" class="dd-item active">
        <a href="/0.12.0/languages/go/">
        Using Go with Fission
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/languages/java/" title="Using Java with Fission JVM environment" class="dd-item ">
        <a href="/0.12.0/languages/java/">
        Using Java with Fission JVM environment
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.12.0/tutorial/" title="Tutorials" class="dd-item 
        
        
        
        ">
      <a href="/0.12.0/tutorial/">
          Tutorials
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/tutorial/enabling-istio-on-fission/" title="Enabling Istio on Fission" class="dd-item ">
        <a href="/0.12.0/tutorial/enabling-istio-on-fission/">
        Enabling Istio on Fission
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/tutorial/java-example/" title="Building Java Functions" class="dd-item ">
        <a href="/0.12.0/tutorial/java-example/">
        Building Java Functions
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.12.0/workflows/" title="Fission Workflows" class="dd-item 
        
        
        
        ">
      <a href="/0.12.0/workflows/">
          Fission Workflows
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.12.0/contributing/" title="Contributing to Fission" class="dd-item 
        
        
        parent
        ">
      <a href="/0.12.0/contributing/">
          Contributing to Fission
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li class="" role=""> 
                  <a class="padding" href="https://github.com/fission/fission"><i class='fa fa-fw fa-github'></i> Github repo</a>
              </li>
          
              <li class="" role=""> 
                  <a class="padding" href="https://github.com/fission/fission/graphs/contributors"><i class='fa fa-fw fa-bullhorn'></i> Credits</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/fission/docs.fission.io/edit/master/docs/content/languages/go.md" target="blank">
                      <i class="fa fa-code-fork"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/0.12.0/'>Fission</a> > <a href='/0.12.0/languages/'>Languages</a> > Using Go with Fission
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#before-you-start">Before you start</a></li>
<li><a href="#add-the-go-environment-to-your-cluster">Add the Go environment to your cluster</a></li>
<li><a href="#write-a-simple-function-in-go">Write a simple function in Go</a></li>
<li><a href="#http-requests-and-http-responses">HTTP requests and HTTP responses</a>
<ul>
<li><a href="#accessing-http-requests">Accessing HTTP Requests</a>
<ul>
<li><a href="#headers">Headers</a></li>
<li><a href="#query-string">Query string</a></li>
<li><a href="#request-body">Request Body</a></li>
</ul></li>
<li><a href="#controlling-http-responses">Controlling HTTP Responses</a>
<ul>
<li><a href="#setting-response-headers">Setting Response Headers</a></li>
<li><a href="#setting-status-codes">Setting Status Codes</a></li>
</ul></li>
</ul></li>
<li><a href="#working-with-dependencies">Working with dependencies</a>
<ul>
<li><a href="#add-dependencies">Add dependencies</a></li>
<li><a href="#custom-builds">Custom builds</a></li>
</ul></li>
<li><a href="#modifying-rebuild-the-environment-images">Modifying/Rebuild the environment images</a></li>
<li><a href="#resource-usage">Resource usage</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Using Go with Fission</h1>
          

        




<p>With Go plugin mechanism, fission supports Go as one of function languages.</p>

<p>In this usage guide we&rsquo;ll cover how to use this environment, write functions, and work with dependencies.</p>

<h2 id="before-you-start">Before you start</h2>

<p>We&rsquo;ll assume you have Fission and Kubernetes setup.  If not, head over
to the <a href="../../installation/">install guide</a>.  Verify your Fission setup with:</p>

<pre><code class="language-bash">$ fission --version
</code></pre>

<h2 id="add-the-go-environment-to-your-cluster">Add the Go environment to your cluster</h2>

<p>Unlike Python, Go is a compiled language that means we need to compile source code before running it.</p>

<p>Fortunately, builder manager within fission does all this hard work automatically when a Go function/package is created.
The Go builder will convert a source package into a deployable package.</p>

<p>To enable Go builder, we need to assign a function builder with flag <code>--builder</code>.</p>

<pre><code>$ fission environment create --name go --image fission/go-env --builder fission/go-builder
</code></pre>

<h2 id="write-a-simple-function-in-go">Write a simple function in Go</h2>

<p>Here is a hello world example (hw.go) in Go:</p>

<pre><code class="language-go">// Due to go plugin mechanism,
// the package of function handler must be main package
package main

import (
    &quot;net/http&quot;
)

// Handler is the entry point for this fission function
func Handler(w http.ResponseWriter, r *http.Request) {
    msg := &quot;Hello, world!\n&quot;
    w.Write([]byte(msg))
}
</code></pre>

<p>The entrypoint of function let go server to know how to load-in plugin file correctly.
Here, our first hello world function&rsquo;s entrypoint is simply the name of function: <code>Handler</code>.</p>

<pre><code class="language-bash"># Create golang env with builder image to build go plugin
$ fission fn create --name helloworld --env go --src hw.go --entrypoint Handler
</code></pre>

<p>Before accessing function, need to ensure deploy package of function is in <em>succeeded</em> state.</p>

<pre><code class="language-bash">$ fission pkg info --name &lt;pkg-name&gt;
</code></pre>

<p>Now, let&rsquo;s test our first Go function with <code>test</code> command</p>

<pre><code class="language-bash">$ fission fn test --name &lt;function-name&gt;
</code></pre>

<div class="notices tip" ><p>See <a href="../../usage/trigger">here</a> for how to setup different trigger for Go function.</p>
</div>


<h2 id="http-requests-and-http-responses">HTTP requests and HTTP responses</h2>

<p>From the sample above we know that go server passes HTTP <code>Request</code> and <code>ResponseWriter</code> to user function for
further processing.</p>

<pre><code class="language-go">func Handler(w http.ResponseWriter, r *http.Request) {
    ...
}
</code></pre>

<p>Following we will go through steps for how to accessing/controlling the requests/responses.</p>

<h3 id="accessing-http-requests">Accessing HTTP Requests</h3>

<h4 id="headers">Headers</h4>

<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;net/http&quot;
    &quot;net/textproto&quot;
)

func Handler(w http.ResponseWriter, r *http.Request) {

    // recommend
    v1 := r.Header.Get(&quot;HEADER_KEY_1&quot;)

    // need to convert string cases manually
    key := textproto.CanonicalMIMEHeaderKey(&quot;HEADER_KEY_2&quot;)
    // v2 type is []string
    v2, _ := r.Header[key]

    w.Write([]byte(fmt.Sprintf(&quot;v1: %s, v2: %v&quot;, v1, v2)))
}
</code></pre>

<p>Let&rsquo;s create a HTTP trigger for the function we created above.</p>

<pre><code class="language-bash">$ fission httptrigger create --method GET --url &quot;/&lt;url&gt;&quot; --function &lt;fn-namne&gt;
</code></pre>

<pre><code class="language-bash">$ curl -X GET http://$FISSION_ROUTER/&lt;url&gt; -H 'HEADER_KEY_1: foo' -H 'HEADER_KEY_2: bar'
v1: foo, v2: [bar]
</code></pre>

<p>One thing worth to notice is all header key will be converted to the canonical format of the MIME header key.
You can access to header value by calling <code>request.Header.Get()</code>. However, if you prefer to access
the value by map index you must convert key format with <code>textproto.CanonicalMIMEHeaderKey()</code>.</p>

<h4 id="query-string">Query string</h4>

<pre><code class="language-go">package main

import (
    &quot;net/http&quot;
)

func Handler(w http.ResponseWriter, r *http.Request) {
    v := r.URL.Query().Get(&quot;key-name&quot;)
    w.Write([]byte(v))
}
</code></pre>

<pre><code class="language-bash">$ curl -X GET http://$FISSION_ROUTER/&lt;url&gt;?key-name=123
123
</code></pre>

<h4 id="request-body">Request Body</h4>

<p><strong>PLAIN TEXT</strong></p>

<pre><code class="language-go">package main

import (
    &quot;io/ioutil&quot;
    &quot;net/http&quot;
)

func Handler(w http.ResponseWriter, r *http.Request) {
    reqBody, err := ioutil.ReadAll(r.Body)
    if err != nil {
        w.WriteHeader(http.StatusBadRequest)
        w.Write([]byte(err.Error()))
    }

    body := string(reqBody)

    w.Write([]byte(body))
}
</code></pre>

<pre><code class="language-bash">$ curl -X POST http://$FISSION_ROUTER/&lt;url&gt; -d foobar
foobar
</code></pre>

<p><strong>JSON</strong></p>

<pre><code class="language-go">package main

import (
    &quot;encoding/json&quot;
    &quot;net/http&quot;
    &quot;io/ioutil&quot;
)

type msg struct {
    Content string `json:&quot;content&quot;`
}

func Handler(w http.ResponseWriter, r *http.Request) {
    reqBody, err := ioutil.ReadAll(r.Body)
    if err != nil {
        w.WriteHeader(http.StatusBadRequest)
        w.Write([]byte(err.Error()))
    }

    m := msg{}
    err = json.Unmarshal(reqBody, &amp;m)
    if err != nil {
        w.WriteHeader(http.StatusBadRequest)
        w.Write([]byte(err.Error()))
    }

    respBody, err := json.Marshal(m)
    if err != nil {
        w.WriteHeader(http.StatusInternalServerError)
        w.Write([]byte(err.Error()))
    }

    w.Write([]byte(respBody))
}
</code></pre>

<pre><code class="language-bash">curl -X POST http://$FISSION_ROUTER/&lt;url&gt; -d '{&quot;content&quot;: &quot;foobar&quot;}'
{&quot;content&quot;:&quot;foobar&quot;}
</code></pre>

<h3 id="controlling-http-responses">Controlling HTTP Responses</h3>

<h4 id="setting-response-headers">Setting Response Headers</h4>

<pre><code class="language-go">package main

import (
    &quot;net/http&quot;
)

func setCORS(w http.ResponseWriter) http.ResponseWriter {
    w.Header().Set(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)
    w.Header().Set(&quot;Access-Control-Allow-Headers&quot;, &quot;*&quot;)
    w.Header().Set(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;)
    w.Header().Set(&quot;Access-Control-Allow-Methods&quot;, &quot;*&quot;)
    w.Header().Set(&quot;Access-Control-Expose-Headers&quot;, &quot;*&quot;)
    return w
}

func Handler(w http.ResponseWriter, r *http.Request) {
    w = setCORS(w)
    w.WriteHeader(http.StatusOK)
}
</code></pre>

<pre><code class="language-bash">$ curl -i -X GET &quot;http://$FISSION_ROUTER/&lt;url&gt;&quot;
HTTP/1.1 200 OK
Access-Control-Allow-Credentials: true
Access-Control-Allow-Headers: *
Access-Control-Allow-Methods: *
Access-Control-Allow-Origin: *
Access-Control-Expose-Headers: *
Content-Length: 0
Content-Type: text/plain; charset=utf-8
Date: Sat, 27 Oct 2018 15:00:14 GMT
</code></pre>

<h4 id="setting-status-codes">Setting Status Codes</h4>

<div class="notices warning" ><p><strong>Always write response status code before writing response body!</strong> Otherwise, the client may receive unexpected status code.</p>
</div>


<p>You can set response status code by calling function <code>writer.WriteHeader()</code>. However, one thing wroth to notice is
if a function writes response body before status code, the client will receive HTTP 200 OK no matter what actual status code
is.</p>

<pre><code class="language-go">package main

import (
    &quot;net/http&quot;
)

func Handler(w http.ResponseWriter, r *http.Request) {
    // DONT
    // w.Write([]byte(&quot;foobar&quot;))
    // w.WriteHeader(http.StatusBadRequest)

    // DO
    http.Error(w, &quot;dummy error&quot;, http.StatusBadRequest)

    // or DO
    // w.WriteHeader(http.StatusBadRequest)
    // w.Write([]byte(&quot;foobar&quot;))
}
</code></pre>

<h2 id="working-with-dependencies">Working with dependencies</h2>

<h3 id="add-dependencies">Add dependencies</h3>

<p>Unlike pip for Python has been widely adopted by community, there are various dependency management tools for Go like <em>gb</em>, <em>dep</em> and <em>glide</em>.
Hence fission Go builder image doesn&rsquo;t contain a default tool for downloading dependencies during build processes.</p>

<p>In order to support 3rd party dependencies, users need to put all necessary packages to <code>vendor</code> directory and archive it into source archive.</p>

<p>Following I will use <strong>glide</strong> to demonstrate how to add dependencies to source archive.</p>

<pre><code class="language-bash">$ mkdir example
$ pushd example
$ glide init --non-interactive
$ glide get &quot;github.com/golang/example/stringutil&quot;
$ curl https://raw.githubusercontent.com/fission/fission/master/examples/go/vendor-example/main.go &gt; main.go
$ zip -r example.zip .
$ fission fn create --name foobar --src example.zip --entrypoint Handler
# wait for package build process
$ fission fn test --name foobar
</code></pre>

<h3 id="custom-builds">Custom builds</h3>

<p>If no custom build script included in source archive, by default builder manager will execute the <a href="https://github.com/fission/fission/tree/master/environments/go/builder">build.sh</a>
in go builder image. In this part, we will go through how to run custom build script during the build process.</p>

<p>Before we write our own script, we need to dive into the original build script to see what&rsquo;s useful inside.</p>

<pre><code class="language-bash">#!/bin/sh

set -eux

srcDir=${GOPATH}/src/$(basename ${SRC_PKG})

trap &quot;rm -rf ${srcDir}&quot; EXIT

if [ -d ${SRC_PKG} ]
then
    echo &quot;Building in directory ${srcDir}&quot;
    ln -sf ${SRC_PKG} ${srcDir}
elif [ -f ${SRC_PKG} ]
then
    echo &quot;Building file ${SRC_PKG} in ${srcDir}&quot;
    mkdir -p ${srcDir}
    cp ${SRC_PKG} ${srcDir}/function.go
fi

cd ${srcDir}
go build -buildmode=plugin -i -o ${DEPLOY_PKG} .
</code></pre>

<p>There are environment variables as shown above:</p>

<ol>
<li>$SRC_PKG: The path to the source code directory/file.</li>
<li>$DEPLOY_PKG: The path to the deploy directory/executable binary.</li>
</ol>

<p>The steps of build script are:</p>

<ol>
<li>Check the $SRC_PKG is a file or directory</li>
<li>Copy/Link source code to $GOPATH</li>
<li>Change location to $SRC_PKG, build source code into plugin file then output to $DEPLOY_PKG</li>
</ol>

<p>For example, we want to add git commit SHA or build timestamp to go binaries like following.</p>

<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;net/http&quot;
)

var (
    Timestamp string
)

// Handler is the entry point for this fission function
func Handler(w http.ResponseWriter, r *http.Request) {
    msg := fmt.Sprintf(&quot;Build timestamp: %v&quot;, Timestamp)
    w.Write([]byte(msg))
}
</code></pre>

<p>To set build timestamp we can set it through <code>ldflags</code> during build process. But it&rsquo;s not supported with original build script.</p>

<p>Since we understand how a build script (customBuild.sh) works, let&rsquo;s try to modify it a little bit.</p>

<pre><code class="language-bash">#!/bin/sh

set -eux

srcDir=${GOPATH}/src/$(basename ${SRC_PKG})

trap &quot;rm -rf ${srcDir}&quot; EXIT

if [ -d ${SRC_PKG} ]
then
    echo &quot;Building in directory ${srcDir}&quot;
    ln -sf ${SRC_PKG} ${srcDir}
elif [ -f ${SRC_PKG} ]
then
    echo &quot;Building file ${SRC_PKG} in ${srcDir}&quot;
    mkdir -p ${srcDir}
    cp ${SRC_PKG} ${srcDir}/function.go
fi


pkgpath=$(basename ${SRC_PKG})
timestamp=$(date +%s)

cd ${srcDir}
go build -ldflags &quot;-X ${pkgpath}.Timestamp=$timestamp&quot; -buildmode=plugin -i -o ${DEPLOY_PKG} .
</code></pre>

<p>At this moment, the directory structure would be like</p>

<pre><code class="language-bash">.
├── customBuild.sh
└── main.go
</code></pre>

<p>Archive source package.</p>

<pre><code class="language-bash">$ chmod +x customBuild.sh
$ zip -r example.zip .

</code></pre>

<p>After editing custom build script, next step is to assign a build command for builder to know what command to run with.</p>

<pre><code class="language-bash">$ fission fn create --name foobar --env go --src example.zip --entrypoint Handler --buildcmd &quot;./customBuild.sh&quot;
$ fission fn test --name foobar
Build timestamp: 1540566887
</code></pre>

<h2 id="modifying-rebuild-the-environment-images">Modifying/Rebuild the environment images</h2>

<p>For how to rebuild environment image, please visit <a href="https://github.com/fission/fission/blob/master/environments/go/README.md">here</a></p>

<h2 id="resource-usage">Resource usage</h2>

<p>By default, a function can use all resource on node it run on, however, other functions will be affected once a function
takes too much resources. To prevent this, Fission allows users to specify a resource limitation for function.</p>

<p>Following are flags to manage function resource usage limitation.</p>

<pre><code class="language-bash">--mincpu value                         Minimum CPU to be assigned to pod (In millicore, minimum 1)
--maxcpu value                         Maximum CPU to be assigned to pod (In millicore, minimum 1)
--minmemory value                      Minimum memory to be assigned to pod (In megabyte)
--maxmemory value                      Maximum memory to be assigned to pod (In megabyte)
</code></pre>

<p>And you can specify them when creating/updating a function.</p>

<pre><code class="language-bash">$ fission fn create --name g1 --env go --src example.zip --entrypoint Handler --mincpu 20 --maxcpu 100 --minmemory 128 --maxmemory 256
</code></pre>

<p>So what&rsquo;s the reasonable resource setting for a function? It really depends on what type of your function is.</p>

<p>Here&rsquo;s a tip, use <code>kubectl top</code> to get actual resource consumption of pod when doing benchmarking. Then you will know what&rsquo;s the best setting for a Go function.</p>

<pre><code class="language-bash">$ kubectl -n fission-function top pod -l functionName=g1
NAME                                                              CPU(cores)   MEMORY(bytes)
go-1ef65ed0-d5eb-11e8-91e8-080027114863-9x7y4xmh-569bfdd9bhmlrf   112m           6Mi
</code></pre>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        

        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/0.12.0/js/clipboard.min.js?1541109125"></script>
    <script src="/0.12.0/js/perfect-scrollbar.min.js?1541109125"></script>
    <script src="/0.12.0/js/perfect-scrollbar.jquery.min.js?1541109125"></script>
    <script src="/0.12.0/js/jquery.sticky.js?1541109125"></script>
    <script src="/0.12.0/js/featherlight.min.js?1541109125"></script>
    <script src="/0.12.0/js/html5shiv-printshiv.min.js?1541109125"></script>
    <script src="/0.12.0/js/highlight.pack.js?1541109125"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/0.12.0/js/modernizr.custom.71422.js?1541109125"></script>
    <script src="/0.12.0/js/learn.js?1541109125"></script>
    <script src="/0.12.0/js/hugo-learn.js?1541109125"></script>

    <link href="/0.12.0/mermaid/mermaid.css?1541109125" type="text/css" rel="stylesheet" />
    <script src="/0.12.0/mermaid/mermaid.js?1541109125"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-86980724-1', 'auto');
  ga('send', 'pageview');
</script>

<script type="text/javascript" src="//script.crazyegg.com/pages/scripts/0059/9755.js" async="async"></script>

  </body>
</html>

