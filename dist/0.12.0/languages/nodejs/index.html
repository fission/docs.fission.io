<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.37" />
    <meta name="description" content="Documentation for Fission">
<meta name="google-site-verification" content="5AvQfeDvIx0ldE9uSKVsoikqgFknd_CT18caf9TNoVg" />
<meta name="author" content="Fission">

    <link rel="shortcut icon" href=/0.12.0/images/favicon.png type="image/x-icon" />
<link rel="icon" href=/0.12.0/images/favicon.png type="image/x-icon" />

    <title>Fission functions with Nodejs :: Serverless Functions for Kubernetes</title>
    
    
    <link href="/0.12.0/css/nucleus.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/font-awesome.min.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/hybrid.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/featherlight.min.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/perfect-scrollbar.min.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/auto-complete.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/theme.css?1541109125" rel="stylesheet">
    <link href="/0.12.0/css/hugo-theme.css?1541109125" rel="stylesheet">
    
      <link href="/0.12.0/css/theme-fission.css?1541109125" rel="stylesheet">
    

    <script src="/0.12.0/js/jquery-2.x.min.js?1541109125"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/0.12.0/languages/nodejs/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://fission.io/">
  <img src=/0.12.0/images/fission-logo.png>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="/0.12.0/js/lunr.min.js?1541109125"></script>
<script type="text/javascript" src="/0.12.0/js/auto-complete.js?1541109125"></script>
<script type="text/javascript">
    
        var baseurl = '\/0.12.0';
    
</script>
<script type="text/javascript" src="/0.12.0/js/search.js?1541109125"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/0.12.0/installation/" title="Installing Fission" class="dd-item 
        
        
        parent
        ">
      <a href="/0.12.0/installation/">
          Installing Fission
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/installation/kubernetessetup/" title="Kubernetes Quick Install" class="dd-item ">
        <a href="/0.12.0/installation/kubernetessetup/">
        Kubernetes Quick Install
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/0.12.0/installation/upgrade/" title="Upgrading Fission" class="dd-item 
        
        
        
        ">
      <a href="/0.12.0/installation/upgrade/">
          Upgrading Fission
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/installation/env_vars/" title="Environment Variables" class="dd-item ">
        <a href="/0.12.0/installation/env_vars/">
        Environment Variables
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.12.0/concepts/" title="Fission Concepts" class="dd-item 
        
        
        parent
        ">
      <a href="/0.12.0/concepts/">
          Fission Concepts
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/concepts/basic-concept/" title="Basic Concepts" class="dd-item ">
        <a href="/0.12.0/concepts/basic-concept/">
        Basic Concepts
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/concepts/executor/" title="Fission Function Executors" class="dd-item ">
        <a href="/0.12.0/concepts/executor/">
        Fission Function Executors
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.12.0/usage/" title="Using Fission" class="dd-item 
        
        
        parent
        ">
      <a href="/0.12.0/usage/">
          Using Fission
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/package/" title="Packaging source code" class="dd-item ">
        <a href="/0.12.0/usage/package/">
        Packaging source code
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/access-secret-cfgmap-in-function/" title="Accessing Secrets in Functions" class="dd-item ">
        <a href="/0.12.0/usage/access-secret-cfgmap-in-function/">
        Accessing Secrets in Functions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/environments/" title="Environments" class="dd-item ">
        <a href="/0.12.0/usage/environments/">
        Environments
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/functions/" title="Functions" class="dd-item ">
        <a href="/0.12.0/usage/functions/">
        Functions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/trigger/" title="Triggers" class="dd-item ">
        <a href="/0.12.0/usage/trigger/">
        Triggers
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/executor/" title="Controlling Function Execution" class="dd-item ">
        <a href="/0.12.0/usage/executor/">
        Controlling Function Execution
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/developer-workflow/" title="Source Code Organization and Your Development Workflow" class="dd-item ">
        <a href="/0.12.0/usage/developer-workflow/">
        Source Code Organization and Your Development Workflow
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/ingress-tutorial/" title="Exposing functions with Ingress" class="dd-item ">
        <a href="/0.12.0/usage/ingress-tutorial/">
        Exposing functions with Ingress
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/usage/canary-deployments/" title="Supporting Canary Deployments for Fission Functions" class="dd-item ">
        <a href="/0.12.0/usage/canary-deployments/">
        Supporting Canary Deployments for Fission Functions
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.12.0/languages/" title="Languages" class="dd-item 
        parent
        
        parent
        ">
      <a href="/0.12.0/languages/">
          Languages
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/languages/nodejs/" title="Fission functions with Nodejs" class="dd-item active">
        <a href="/0.12.0/languages/nodejs/">
        Fission functions with Nodejs
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/languages/go/" title="Using Go with Fission" class="dd-item ">
        <a href="/0.12.0/languages/go/">
        Using Go with Fission
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/languages/java/" title="Using Java with Fission JVM environment" class="dd-item ">
        <a href="/0.12.0/languages/java/">
        Using Java with Fission JVM environment
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.12.0/tutorial/" title="Tutorials" class="dd-item 
        
        
        
        ">
      <a href="/0.12.0/tutorial/">
          Tutorials
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/tutorial/enabling-istio-on-fission/" title="Enabling Istio on Fission" class="dd-item ">
        <a href="/0.12.0/tutorial/enabling-istio-on-fission/">
        Enabling Istio on Fission
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.12.0/tutorial/java-example/" title="Building Java Functions" class="dd-item ">
        <a href="/0.12.0/tutorial/java-example/">
        Building Java Functions
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.12.0/workflows/" title="Fission Workflows" class="dd-item 
        
        
        
        ">
      <a href="/0.12.0/workflows/">
          Fission Workflows
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.12.0/contributing/" title="Contributing to Fission" class="dd-item 
        
        
        parent
        ">
      <a href="/0.12.0/contributing/">
          Contributing to Fission
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li class="" role=""> 
                  <a class="padding" href="https://github.com/fission/fission"><i class='fa fa-fw fa-github'></i> Github repo</a>
              </li>
          
              <li class="" role=""> 
                  <a class="padding" href="https://github.com/fission/fission/graphs/contributors"><i class='fa fa-fw fa-bullhorn'></i> Credits</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/fission/docs.fission.io/edit/master/docs/content/languages/nodejs.md" target="blank">
                      <i class="fa fa-code-fork"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/0.12.0/'>Fission</a> > <a href='/0.12.0/languages/'>Languages</a> > Fission functions with Nodejs
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#before-you-start">Before you start</a></li>
<li><a href="#add-the-nodejs-runtime-environment-to-your-cluster">Add the Nodejs runtime environment to your cluster</a></li>
<li><a href="#write-a-simple-function-in-nodejs">Write a simple function in Nodejs</a></li>
<li><a href="#http-requests-and-http-responses">HTTP requests and HTTP responses</a>
<ul>
<li><a href="#accessing-http-requests">Accessing HTTP Requests</a>
<ul>
<li><a href="#headers">Headers</a></li>
<li><a href="#query-string">Query string</a></li>
<li><a href="#body">Body</a></li>
</ul></li>
<li><a href="#controlling-http-responses">Controlling HTTP Responses</a>
<ul>
<li><a href="#setting-response-headers">Setting Response Headers</a></li>
<li><a href="#setting-status-codes">Setting Status Codes</a></li>
</ul></li>
</ul></li>
<li><a href="#working-with-dependencies">Working with dependencies</a>
<ul>
<li><a href="#using-fission-nodejs-builder-image">Using fission nodejs builder image</a>
<ul>
<li><a href="#example-of-using-the-nodejs-builder-image">Example of using the nodejs builder image</a></li>
<li><a href="#details-of-the-fission-nodejs-builder-image">Details of the fission nodejs builder image</a></li>
</ul></li>
<li><a href="#creating-a-custom-nodejs-builder-image">Creating a custom nodejs builder image</a></li>
</ul></li>
<li><a href="#modifying-the-nodejs-runtime-image">Modifying the nodejs runtime image</a></li>
<li><a href="#resource-usage">Resource usage</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Fission functions with Nodejs</h1>
          

        




<p>Fission supports functions written in Nodejs. Current fission nodejs runtime environment supports node version greater than 7.6.0. In this usage guide we&rsquo;ll cover how to use this environment, write functions, and work with dependencies.</p>

<h2 id="before-you-start">Before you start</h2>

<p>We assume you have Fission and Kubernetes setup. If not, head over to the <a href="../installation/_index.en.md">install guide</a>.  Verify your Fission setup with:</p>

<pre><code>fission --version
</code></pre>

<h2 id="add-the-nodejs-runtime-environment-to-your-cluster">Add the Nodejs runtime environment to your cluster</h2>

<p>Fission language support is enabled by creating an <em>Environment</em>.  An
environment is the language-specific part of Fission.  It has a
container image in which your function will run.</p>

<pre><code>fission environment create --name nodejs --image fission/node-env
</code></pre>

<h2 id="write-a-simple-function-in-nodejs">Write a simple function in Nodejs</h2>

<p>Create a file helloWorld.js with the following content</p>

<pre><code>module.exports = async function(context) {
    return {
        status: 200,
        body: &quot;hello, world!\n&quot;
    };
}
</code></pre>

<p>Create a function with the following command. Note that the value for <code>--env</code> flag is <code>nodejs</code> which was created with <code>fission env create</code> command above.</p>

<pre><code>fission function create --name hello-world --code hello-world.js --env nodejs
</code></pre>

<p>Test the function with the below command and you should see &ldquo;hello, world!&rdquo; in the output</p>

<pre><code>fission fn test --name hello-world
</code></pre>

<h2 id="http-requests-and-http-responses">HTTP requests and HTTP responses</h2>

<h3 id="accessing-http-requests">Accessing HTTP Requests</h3>

<p>This section gives a few examples of invoking nodejs functions with HTTP requests and how HTTP request components can be extracted inside the function.
While these examples give you a rough idea of the usage, there are more real world examples <a href="HTTPs://github.com/fission/fission/tree/master/examples/nodejs">here</a></p>

<h4 id="headers">Headers</h4>

<p>Here&rsquo;s an example of extracting HTTP headers from the HTTP request.</p>

<p>Create a file hello.js with the following content. Here the function tries to access the value associated with header with name &lsquo;x-internal-token&rsquo; and it could potentially do some authentication and authorization on the token before returning the response.</p>

<pre><code>module.exports = async function(context) {
    console.log(context.request.headers);
    var token = context.request.headers['x-internal-token'];
    console.log(&quot;Token presented : &quot;, token);

    // do some authn and authz based on token received
    
    return {
        status: 200,
        body: &quot;hello world!&quot;
    }
}
</code></pre>

<p>Create a function with the following command.</p>

<pre><code>fission function create --name hello-world --code helloWorld.js --env nodejs
</code></pre>

<p>Create an HTTP trigger to invoke the function</p>

<pre><code>fission HTTPtrigger create --url /hello-world --function hello-world
</code></pre>

<p>Test the function with the below command and you should see &ldquo;hello, world!&rdquo; in the output</p>

<pre><code>curl HTTP://$FISSION_ROUTER/hello-world -H &quot;X-Internal-Token: abcdefghtsdfjsldjf123&quot;
</code></pre>

<h4 id="query-string">Query string</h4>

<p>Here&rsquo;s an example of extracting the query string from the HTTP request.</p>

<p>Create a file helloUser.js with the following content. Here the function tries to read the value of query parameter user and returns &ldquo;hello <value supplied as user parameter>&rdquo;.</p>

<pre><code>var url = require('url');

module.exports = async function(context) {
    console.log(context.request.url)

    var url_parts = url.parse(context.request.url, true);
    var query = url_parts.query;

    console.log(&quot;query user : &quot;, query.user);

    return {
        status: 200,
        body: &quot;hello &quot; + query.user + &quot;!&quot;
    }
}
</code></pre>

<p>Create a function with the following command.</p>

<pre><code>fission function create --name hello-user --code helloUser.js --env nodejs
</code></pre>

<p>Create an HTTP trigger to invoke the function</p>

<pre><code>fission HTTPtrigger create --url /hello-user --function hello-user
</code></pre>

<p>Test the function with the below command and you should see &ldquo;hello, foo!&rdquo; in the output</p>

<pre><code>curl HTTP://$FISSION_ROUTER/header-example?user=foo
</code></pre>

<h4 id="body">Body</h4>

<p>First lets see an example of a function which extracts a request body in JSON format.</p>

<p>Create a file jobStatus.js with the following content. Here the function tries to extract the &lsquo;job_id&rsquo; and the &lsquo;job_status&rsquo; from the HTTP request body and could potentially persist the status somewhere.</p>

<pre><code>module.exports = async function(context) {
    const job = context.request.body.job_id;
    const jobStatus = context.request.body.job_status;

    // do some db write if required to save the status

    return {
        status: 200,
        body: &quot;Successfully saved job status for job ID: &quot; + job
    };
}
</code></pre>

<p>Create a function with the following command.</p>

<pre><code>fission function create --name job-status --code jobStatus.js --env nodejs
</code></pre>

<p>Create an HTTP trigger to invoke the function</p>

<pre><code>fission HTTPtrigger create --url /job-status --function job-status --method POST 
</code></pre>

<p>Invoke the function with a POST HTTP request with the appropriate JSON body and you will see the response &ldquo;Successfully saved job status for job ID: 1234&rdquo;</p>

<pre><code>curl -XPOST HTTP://$FISSION_ROUTER/job-status -d '{&quot;job_id&quot; : &quot;1234&quot;, &quot;job_status&quot;: &quot;Passed&quot;}'
</code></pre>

<p>Next lets see an example of writing a function which extracts a request body in the Plain Text format</p>

<p>Create a file wordCount.js with the following content. Here the function tries to extract a request body and returns the word count of the input text.</p>

<pre><code>module.exports = async function(context) {
    var splitStringArray = context.request.body.split(&quot; &quot;);

    return {
        status: 200,
        body: &quot;word count &quot; + splitStringArray.length
    };
}
</code></pre>

<p>Create a function with the following command.</p>

<pre><code>fission function create --name word-count --code wordCount.js --env nodejs
</code></pre>

<p>Create an HTTP trigger to invoke the function</p>

<pre><code>fission HTTPtrigger create --url /word-count --function word-count --method POST 
</code></pre>

<p>Invoke the function with a POST HTTP request with a text body and you will see the count of number of words in the HTTP response.</p>

<pre><code>curl -XPOST -H &quot;Content-Type: text/plain&quot; HTTP://$FISSION_ROUTER/word-count -d '{&quot;It's a beautiful day!&quot;}'
</code></pre>

<h3 id="controlling-http-responses">Controlling HTTP Responses</h3>

<p>This section gives a few examples of invoking nodejs functions with HTTP requests and how the function can return various values as part of HTTP response headers and body.</p>

<h4 id="setting-response-headers">Setting Response Headers</h4>

<p>Create a file functionMetadata.js with the following content. Here the function returns the fission function metadata added by Fission Router as part of the HTTP response header to the user.</p>

<pre><code>module.exports = async function(context) {
    console.log(context.request.headers);
    
    return {
        status: 200,
        headers: {
            'x-fission-function-name': context.request.headers['x-fission-function-name'],
            'x-fission-function-namespace': context.request.headers['x-fission-function-namespace'],
            'x-fission-function-resourceversion': context.request.headers['x-fission-function-resourceversion'],
            'x-fission-function-uid': context.request.headers['x-fission-function-uid'],
        },
        body: &quot;hello world!&quot;
    }
}
</code></pre>

<p>Create a function with the following command.</p>

<pre><code>fission function create --name function-metadata --code functionMetadata.js --env nodejs
</code></pre>

<p>Create an HTTP trigger to invoke the function</p>

<pre><code>fission HTTPtrigger create --url /function-metadata --function word-count
</code></pre>

<p>Invoke the function with a &lsquo;-v&rsquo; flag on curl command to display all headers</p>

<pre><code>curl HTTP://$FISSION_ROUTER/function-metadata -v
</code></pre>

<p>We can see the headers in the output as below</p>

<pre><code>*   Trying 0.0.0.0
.
.
.
&lt; HTTP/1.1 200 OK
&lt; Content-Length: 12
&lt; Content-Type: text/html; charset=utf-8
&lt; Date: Tue, 23 Oct 2018 19:01:55 GMT
&lt; Etag: W/&quot;c-QwzjTQIHJO11oZbfwq1nx3dy0Wk&quot;
&lt; X-Fission-Function-Name: header-example
&lt; X-Fission-Function-Namespace: default
&lt; X-Fission-Function-Resourceversion: 19413500
&lt; X-Fission-Function-Uid: 0014884b-d6e7-11e8-afb7-42010a800194
&lt; X-Powered-By: Express
&lt; 
* Connection #0 to host 0.0.0.0 left intact
hello world!
</code></pre>

<h4 id="setting-status-codes">Setting Status Codes</h4>

<p>Create a file validateInput.js with the following content. Here the function tries to validate an input parameter &ldquo;job_id&rdquo; and sends a HTTP response code 400 when validation fails.</p>

<pre><code>module.exports = async function(context) {
    const job = context.request.body.job_id;
    const jobStatus = context.request.body.job_status;

    console.log(&quot;Received CI job id: &quot; + job + &quot; job status: &quot; + jobStatus );

    if (!job) {
        return {
            status: 400,
            body: &quot;job_id cannot be empty&quot;
        };
    }

    return {
        status: 200,
        body: &quot;Successfully saved CI job status for job ID: &quot; + job
    };
}
</code></pre>

<p>Create a function with the following command.</p>

<pre><code>fission function create --name error-handling --code validateInput.js --env nodejs
</code></pre>

<p>Create an HTTP trigger to invoke the function</p>

<pre><code>fission HTTPtrigger create --url /error-handling --function error-handling --method POST 
</code></pre>

<p>Invoke the function with this curl command where job_id is empty and you should see &ldquo;job_id cannot be empty&rdquo;</p>

<pre><code>curl -XPOST HTTP://$FISSION_ROUTER/error-handling -d '{&quot;job_status&quot;: &quot;Passed&quot;}'
</code></pre>

<h2 id="working-with-dependencies">Working with dependencies</h2>

<p>There may be instances where functions need to require node modules that are not packed into the nodejs runtime environment. In such instances, nodejs builder image could be used to <code>npm install</code> those modules.
This section describes ways in which this can be achieved.</p>

<h3 id="using-fission-nodejs-builder-image">Using fission nodejs builder image</h3>

<h4 id="example-of-using-the-nodejs-builder-image">Example of using the nodejs builder image</h4>

<p>fission docker hub has a nodejs builder image <code>fission/node-builder</code>. Here&rsquo;s an example of using this image.</p>

<p>First, create an environment with runtime image and builder image as follows</p>

<pre><code>fission environment create --name nodejs --image fission/node-env --builder fission/node-builder
</code></pre>

<p>Next, create a file momentExample.js with the following content. This file requires &lsquo;moment&rsquo; node_module that is not packed into the fission runtime image. Also create a package.json with &lsquo;moment&rsquo; listed in dependencies section.</p>

<pre><code>const momentpackage = require('moment')

module.exports = async function(context) {

    return {
        status: 200,
        body: momentpackage().format()
    };
}  
</code></pre>

<p>Sample package.json</p>

<pre><code>{
  &quot;name&quot;: &quot;fission-nodejs-runtime&quot;,
  &quot;engines&quot;: {
    &quot;node&quot;: &quot;&gt;=7.6.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;moment&quot;: &quot;*&quot;
  }
}
</code></pre>

<p>Next, create a zip archive of these 2 files with <code>zip momentExample.js package.json</code> , let&rsquo;s call it node-source-example.zip</p>

<p>Now create a fission source package with the zip file just created. This command outputs the name of the package created.</p>

<pre><code>fission package create --src node-source-example.zip --env nodejs
</code></pre>

<p>Next, create a fission function with the package created above, let&rsquo;s assume the package name is &lsquo;node-source-example-abcd&rsquo;</p>

<pre><code>fission function create --name node-builder-example --pkg node-source-example-abcd --env nodejs --entrypoint moment-example
</code></pre>

<p>If everything was successful so far, then, build status of the source package will be set to &lsquo;succeeded&rsquo;. This can be checked with the following command.</p>

<pre><code>fission package info --name node-source-example-abcd
</code></pre>

<p>Next, test your function with the following and the output should have the current time.</p>

<pre><code>fission fn test --name node-builder-example
</code></pre>

<h4 id="details-of-the-fission-nodejs-builder-image">Details of the fission nodejs builder image</h4>

<p>The builder has a build.sh script that performs an <code>npm install</code> of the node modules listed in user provided package.json. The builder image runs this script and packages the result into an archive.<br />
When the function is invoked, one of the pods running the runtime image is specialized. What this means is that the archive created by the builder is fetched and extracted in the file system.
Next, the user function is loaded according to the entry point specified with <code>fission fn create command</code></p>

<h3 id="creating-a-custom-nodejs-builder-image">Creating a custom nodejs builder image</h3>

<p>If you&rsquo;d like to do more than just <code>npm install</code> in the build step, you could customize the build.sh.
Here&rsquo;s the link to the source code of fission <a href="HTTPs://github.com/fission/fission/tree/master/environments/nodejs/builder">nodejs builder</a></p>

<p>As you can see, the build.sh performs a <code>npm install</code> inside a directory defined by the environment variable SRC_PKG and copies the built archive into a directory defined by environment variable DEPLOY_PKG
You could create a customized version of this build.sh with whatever additional commands needed to be run during the build step.</p>

<p>Finally the image can be built with <code>docker build -t &lt;USER&gt;/nodejs-custom-builder .</code> and pushed to docker hub with <code>docker push &lt;USER&gt;/nodejs-custom-builder</code></p>

<p>Now you are ready to create a nodejs env with your custom builder image supplied to <code>--builder</code> flag</p>

<h2 id="modifying-the-nodejs-runtime-image">Modifying the nodejs runtime image</h2>

<p>If you wish to modify the nodejs runtime image to add more dependencies without using/creating a builder image, you can do so too.</p>

<p>Here&rsquo;s the link to the source code of fission <a href="HTTPs://github.com/fission/fission/tree/master/environments/nodejs">nodejs runtime</a></p>

<p>As you can see, there is a package.json in the directory with a list of node modules listed under dependencies section.
You can add the node modules required to this list and then build the docker image with <code>docker build -t &lt;USER&gt;/nodejs-custom-runtime .</code> and push the image <code>docker push &lt;USER&gt;/nodejs-custom-runtime</code></p>

<p>You are now ready to create a nodejs env with your image supplied to <code>--image</code> flag</p>

<h2 id="resource-usage">Resource usage</h2>

<p>Currently the nodejs environment containers are run with default memory limit of 512 MiB and a memory request of 256 MiB. Also, a default CPU limit of 1 and a CPU request of 0.5 cores.</p>

<p>If you wish to create functions with higher resource requirements, you could supply <code>--mincpu</code>, <code>--maxcpu</code>, <code>--minmemory</code> and <code>--maxmemory</code> flags during <code>fission fn create</code>. Also supply <code>--executortype newdeploy</code> to the CLI.</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        

        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/0.12.0/js/clipboard.min.js?1541109125"></script>
    <script src="/0.12.0/js/perfect-scrollbar.min.js?1541109125"></script>
    <script src="/0.12.0/js/perfect-scrollbar.jquery.min.js?1541109125"></script>
    <script src="/0.12.0/js/jquery.sticky.js?1541109125"></script>
    <script src="/0.12.0/js/featherlight.min.js?1541109125"></script>
    <script src="/0.12.0/js/html5shiv-printshiv.min.js?1541109125"></script>
    <script src="/0.12.0/js/highlight.pack.js?1541109125"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/0.12.0/js/modernizr.custom.71422.js?1541109125"></script>
    <script src="/0.12.0/js/learn.js?1541109125"></script>
    <script src="/0.12.0/js/hugo-learn.js?1541109125"></script>

    <link href="/0.12.0/mermaid/mermaid.css?1541109125" type="text/css" rel="stylesheet" />
    <script src="/0.12.0/mermaid/mermaid.js?1541109125"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-86980724-1', 'auto');
  ga('send', 'pageview');
</script>

<script type="text/javascript" src="//script.crazyegg.com/pages/scripts/0059/9755.js" async="async"></script>

  </body>
</html>

