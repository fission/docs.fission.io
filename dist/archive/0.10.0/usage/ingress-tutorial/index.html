<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.35" />
    <meta name="description" content="Documentation for Fission">
<meta name="google-site-verification" content="5AvQfeDvIx0ldE9uSKVsoikqgFknd_CT18caf9TNoVg" />
<meta name="author" content="Fission">

    <link rel="shortcut icon" href=/0.10.0/images/favicon.png type="image/x-icon" />
<link rel="icon" href=/0.10.0/images/favicon.png type="image/x-icon" />

    <title>Exposing functions with Ingress :: Serverless Functions for Kubernetes</title>
    
    
    <link href="/0.10.0/css/nucleus.css?1538420079" rel="stylesheet">
    <link href="/0.10.0/css/font-awesome.min.css?1538420079" rel="stylesheet">
    <link href="/0.10.0/css/hybrid.css?1538420079" rel="stylesheet">
    <link href="/0.10.0/css/featherlight.min.css?1538420079" rel="stylesheet">
    <link href="/0.10.0/css/perfect-scrollbar.min.css?1538420079" rel="stylesheet">
    <link href="/0.10.0/css/auto-complete.css?1538420079" rel="stylesheet">
    <link href="/0.10.0/css/theme.css?1538420079" rel="stylesheet">
    <link href="/0.10.0/css/hugo-theme.css?1538420079" rel="stylesheet">
    
      <link href="/0.10.0/css/theme-fission.css?1538420079" rel="stylesheet">
    

    <script src="/0.10.0/js/jquery-2.x.min.js?1538420079"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/0.10.0/usage/ingress-tutorial/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://fission.io/">
  <img src=/0.10.0/images/fission-logo.png>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="/0.10.0/js/lunr.min.js?1538420079"></script>
<script type="text/javascript" src="/0.10.0/js/auto-complete.js?1538420079"></script>
<script type="text/javascript">
    
        var baseurl = '\/0.10.0';
    
</script>
<script type="text/javascript" src="/0.10.0/js/search.js?1538420079"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/0.10.0/installation/" title="Installing Fission" class="dd-item 
        
        
        parent
        ">
      <a href="/0.10.0/installation/">
          Installing Fission
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/installation/kubernetessetup/" title="Kubernetes Quick Install" class="dd-item ">
        <a href="/0.10.0/installation/kubernetessetup/">
        Kubernetes Quick Install
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/0.10.0/installation/upgrade/" title="Upgrading Fission" class="dd-item 
        
        
        
        ">
      <a href="/0.10.0/installation/upgrade/">
          Upgrading Fission
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/installation/env_vars/" title="Environment Variables" class="dd-item ">
        <a href="/0.10.0/installation/env_vars/">
        Environment Variables
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.10.0/concepts/" title="Fission Concepts" class="dd-item 
        
        
        parent
        ">
      <a href="/0.10.0/concepts/">
          Fission Concepts
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/concepts/basic-concept/" title="Basic Concepts" class="dd-item ">
        <a href="/0.10.0/concepts/basic-concept/">
        Basic Concepts
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/concepts/executor/" title="Fission Function Executors" class="dd-item ">
        <a href="/0.10.0/concepts/executor/">
        Fission Function Executors
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.10.0/usage/" title="Using Fission" class="dd-item 
        parent
        
        parent
        ">
      <a href="/0.10.0/usage/">
          Using Fission
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/usage/package/" title="Packaging source code" class="dd-item ">
        <a href="/0.10.0/usage/package/">
        Packaging source code
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/usage/access-secret-cfgmap-in-function/" title="Accessing Secrets in Functions" class="dd-item ">
        <a href="/0.10.0/usage/access-secret-cfgmap-in-function/">
        Accessing Secrets in Functions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/usage/environments/" title="Environments" class="dd-item ">
        <a href="/0.10.0/usage/environments/">
        Environments
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/usage/functions/" title="Functions" class="dd-item ">
        <a href="/0.10.0/usage/functions/">
        Functions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/usage/trigger/" title="Triggers" class="dd-item ">
        <a href="/0.10.0/usage/trigger/">
        Triggers
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/usage/executor/" title="Controlling Function Execution" class="dd-item ">
        <a href="/0.10.0/usage/executor/">
        Controlling Function Execution
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/usage/developer-workflow/" title="Source Code Organization and Your Development Workflow" class="dd-item ">
        <a href="/0.10.0/usage/developer-workflow/">
        Source Code Organization and Your Development Workflow
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/usage/ingress-tutorial/" title="Exposing functions with Ingress" class="dd-item active">
        <a href="/0.10.0/usage/ingress-tutorial/">
        Exposing functions with Ingress
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.10.0/contributing/" title="Contributing to Fission" class="dd-item 
        
        
        parent
        ">
      <a href="/0.10.0/contributing/">
          Contributing to Fission
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/contributing/compiling/" title="Compiling Fission" class="dd-item ">
        <a href="/0.10.0/contributing/compiling/">
        Compiling Fission
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.10.0/tutorial/" title="Tutorials" class="dd-item 
        
        
        
        ">
      <a href="/0.10.0/tutorial/">
          Tutorials
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/tutorial/enabling-istio-on-fission/" title="Enabling Istio on Fission" class="dd-item ">
        <a href="/0.10.0/tutorial/enabling-istio-on-fission/">
        Enabling Istio on Fission
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.10.0/tutorial/java-example/" title="Building Java Functions" class="dd-item ">
        <a href="/0.10.0/tutorial/java-example/">
        Building Java Functions
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.10.0/workflows/" title="Fission Workflows" class="dd-item 
        
        
        
        ">
      <a href="/0.10.0/workflows/">
          Fission Workflows
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li class="" role=""> 
                  <a class="padding" href="https://github.com/fission/fission"><i class='fa fa-fw fa-github'></i> Github repo</a>
              </li>
          
              <li class="" role=""> 
                  <a class="padding" href="https://github.com/fission/fission/graphs/contributors"><i class='fa fa-fw fa-bullhorn'></i> Credits</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/fission/docs.fission.io/edit/master/docs/content/usage/ingress-tutorial.md" target="blank">
                      <i class="fa fa-code-fork"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/0.10.0/'>Fission</a> > <a href='/0.10.0/usage/'>Using Fission</a> > Exposing functions with Ingress
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#setup-pre-requisites">Setup &amp; pre-requisites</a>
<ul>
<li><a href="#setup-an-ingress-controller">Setup an Ingress Controller</a></li>
</ul></li>
<li><a href="#deploying-function-with-ingress">Deploying Function with ingress</a>
<ul>
<li><a href="#create-a-function">Create a function</a></li>
<li><a href="#create-a-internal-route">Create a internal route</a></li>
<li><a href="#create-a-external-route">Create a external route</a></li>
<li><a href="#create-a-fqdn-route">Create a FQDN route</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Exposing functions with Ingress</h1>
          

        




<p>This tutorial will walk you through exposing a function using an ingress controller (You can read more about ingress and ingress controller <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#ingress-controllers">here</a>). We will make the function available on a fully qualified domain name (FQDN) using Fission&rsquo;s route and ingress controller setup in a cloud environment.</p>

<h2 id="setup-pre-requisites">Setup &amp; pre-requisites</h2>

<p>You will need a Kubernetes cluster with Fission installed (Please
check <a href="../../installation/">installation page</a> for details). This tutorial uses a cloud load balancer, but if you are using Minikube you might want <a href="https://github.com/kubernetes/minikube/issues/496">to take a look at details here</a></p>

<p>Later parts of this tutorial use a FQDN to reach the function. If you plan to go along in this section, you will need a domain name setup and access to modify the NS records and create A record in the zone of the domain name you have. The tutorial uses Google cloud to walk through the tutorial but you can use any cloud you prefer to. Also the changes in name server can take 24-48 hours so you may want to use an already created domain name.</p>

<h3 id="setup-an-ingress-controller">Setup an Ingress Controller</h3>

<p>First thing we will need is an ingress controller and we will use Nginx ingress controller in this tutorial. Based on your setup you can choose <a href="https://kubernetes.github.io/ingress-nginx/deploy/">one of the multiple ways to install Nginx ingress controller</a>. This setup should work with other ingress controllers also but has not been tested.</p>

<p>Let&rsquo;s verify that the installation succeeded:</p>

<pre><code>kubectl get all -n ingress-nginx
NAME                                           READY     STATUS    RESTARTS   AGE
po/default-http-backend-66b447d9cf-4q8f7       1/1       Running   0          19d
po/nginx-ingress-controller-58fcfdc6fd-2cwts   1/1       Running   0          19d

NAME                       CLUSTER-IP      EXTERNAL-IP      PORT(S)                      AGE
svc/default-http-backend   10.11.243.109   &lt;none&gt;           80/TCP                       19d
svc/ingress-nginx          10.11.245.254   35.200.150.175   80:31000/TCP,443:30666/TCP   19d

NAME                              DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deploy/default-http-backend       1         1         1            1           19d
deploy/nginx-ingress-controller   1         1         1            1           19d

NAME                                     DESIRED   CURRENT   READY     AGE
rs/default-http-backend-66b447d9cf       1         1         1         19d
rs/nginx-ingress-controller-58fcfdc6fd   1         1         1         19d

</code></pre>

<p>Following are key points to validate that ingress controller installation succeeded (Please refer to output of a successful installation above)</p>

<ul>
<li>The ingress controller pod is up and running</li>
<li>The ingress-nginx service has a external IP address populated</li>
<li>If you hit the external IP address of the ingress-nginx, you get the default backend page:</li>
</ul>

<pre><code>curl http://35.200.150.175

default backend - 404
</code></pre>

<h2 id="deploying-function-with-ingress">Deploying Function with ingress</h2>

<p>An ingress resource allows traffic from outside the cluster to reach the services inside the cluster. The ingress is fulfilled by an ingress controller. In following sections we will create a function and enable traffic outside the cluster to reach the function.</p>

<h3 id="create-a-function">Create a function</h3>

<p>We will create an environment, a function and test that it works:</p>

<pre><code>$ fission env create --name nodejs --image fission/node-env
environment 'nodejs' created

$ cat hello.js 
module.exports = async function(context) {
    return {
        status: 200,
        body: &quot;Hello, Fission!\n&quot;
    };
}

$ fission fn create --name hello --env nodejs --code hello.js 
function 'hello' created

$ fission fn test --name hello
Hello, Fission!

</code></pre>

<h3 id="create-a-internal-route">Create a internal route</h3>

<p>Let&rsquo;s create a route which is not exposed via the ingress controller so that it can be consumed by resources inside the cluster only.</p>

<p>Currently since functions are also exposed via the Fission router, the function can be accessed from outside the cluster but in future the router may not expose all functions outside the cluster.</p>

<pre><code>$ fission route create --url /ihello --function hello
trigger '249838c9-9ae3-492a-bba1-b0464ae65671' created
$ fission route list
NAME                                 METHOD HOST URL     INGRESS FUNCTION_NAME
249838c9-9ae3-492a-bba1-b0464ae65671 GET         /ihello false   hello
</code></pre>

<p>This route will be accessible at <code>http://$FISSION_ROUTER/ihello</code> but if tried to access on the ingress controller address <code>http://&lt;INGRESS-CONTROLLER-EXTERNAL-IP&gt;/ihello</code> you will get a default backend page. This is expected result as we did not create an ingress for this route.</p>

<h3 id="create-a-external-route">Create a external route</h3>

<p>Now let&rsquo;s create a route which we will expose over ingress controller. We will create a route with <code>createingress</code> flag enabled:</p>

<pre><code>$ fission route create --url /hello --function hello --createingress
trigger '301b3cb0-5ac1-4211-a1ed-2b0ad9143e34' created
$ 
$ fission route list
NAME                                 METHOD HOST URL     INGRESS FUNCTION_NAME
249838c9-9ae3-492a-bba1-b0464ae65671 GET         /ihello false   hello
301b3cb0-5ac1-4211-a1ed-2b0ad9143e34 GET         /hello  true    hello
$ 

</code></pre>

<p>If you check the ingress controller pod logs, you will notice that the ingress controller has re-loaded the configuration for the newly created ingress resource:</p>

<pre><code>I0604 12:47:08.983567       5 controller.go:168] backend reload required
I0604 12:47:08.985535       5 event.go:218] Event(v1.ObjectReference{Kind:&quot;Ingress&quot;, Namespace:&quot;fission&quot;, Name:&quot;301b3cb0-5ac1-4211-a1ed-2b0ad9143e34&quot;, UID:&quot;64bffe8c-67f5-11e8-98e8-42010aa00018&quot;, APIVersion:&quot;extensions&quot;, ResourceVersion:&quot;18017617&quot;, FieldPath:&quot;&quot;}): type: 'Normal' reason: 'CREATE' Ingress fission/301b3cb0-5ac1-4211-a1ed-2b0ad9143e34
I0604 12:47:09.117629       5 controller.go:177] ingress backend successfully reloaded...
</code></pre>

<p>If you now hit the function at ingress controller&rsquo;s IP and the path (<code>http://&lt;INGRESS-CONTROLLER-EXTERNAL-IP&gt;/hello</code>), you will get function&rsquo;s response. Depending on your setup and settings, you will have to try HTTP or HTTPS. Some ingress controllers enable SSL redirect by default and hence the HTTPS URL has to be accessed.</p>

<pre><code>$ curl -k  https://35.200.150.175/hello
Hello, Fission!

</code></pre>

<h3 id="create-a-fqdn-route">Create a FQDN route</h3>

<p>This is an optional step and pre-requisites should be fulfilled before proceeding. You can map the FQDN to function if you have DNS setup and access. You need to do a few steps:</p>

<ul>
<li><p>Map the domain name&rsquo;s name server to your cloud provider. For example we used domain name fission.sh and mapped the name server to google cloud (Since this tutorial setup is on Google cloud). The instructions are specific to your domain name provider, please check the documentation of the provider.</p></li>

<li><p>Create a zone for the root domain in the cloud provider (Created a zone for fission.sh in google cloud)</p></li>

<li><p>Create a sub-domain A record that maps to the IP address of Ingress Controller load balancer. In this tutorial we created a A record in the zone above for ing.fission.sh and pointed to the IP of ingress controller load balancer i.e. 35.200.150.175 (A records can take 30 minutes to 4 hours to update)</p></li>

<li><p>If all these steps are configured properly, we can hit the function at FQDN like below:</p></li>
</ul>

<pre><code>$ curl -k  https://ing.fission.sh/hello
Hello, Fission!

</code></pre>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        

        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/0.10.0/js/clipboard.min.js?1538420079"></script>
    <script src="/0.10.0/js/perfect-scrollbar.min.js?1538420079"></script>
    <script src="/0.10.0/js/perfect-scrollbar.jquery.min.js?1538420079"></script>
    <script src="/0.10.0/js/jquery.sticky.js?1538420079"></script>
    <script src="/0.10.0/js/featherlight.min.js?1538420079"></script>
    <script src="/0.10.0/js/html5shiv-printshiv.min.js?1538420079"></script>
    <script src="/0.10.0/js/highlight.pack.js?1538420079"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/0.10.0/js/modernizr.custom.71422.js?1538420079"></script>
    <script src="/0.10.0/js/learn.js?1538420079"></script>
    <script src="/0.10.0/js/hugo-learn.js?1538420079"></script>

    <link href="/0.10.0/mermaid/mermaid.css?1538420079" type="text/css" rel="stylesheet" />
    <script src="/0.10.0/mermaid/mermaid.js?1538420079"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-86980724-1', 'auto');
  ga('send', 'pageview');
</script>

<script type="text/javascript" src="//script.crazyegg.com/pages/scripts/0059/9755.js" async="async"></script>

  </body>
</html>

