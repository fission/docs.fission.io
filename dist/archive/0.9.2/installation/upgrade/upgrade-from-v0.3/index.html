<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.35" />
    <meta name="description" content="Documentation for Fission">
<meta name="author" content="Fission">

    <link rel="shortcut icon" href=/0.9.2/images/favicon.png type="image/x-icon" />
<link rel="icon" href=/0.9.2/images/favicon.png type="image/x-icon" />

    <title>Upgrading from v0.3 to v0.4.x :: Serverless Functions for Kubernetes</title>
    
    
    <link href="/0.9.2/css/nucleus.css?1532541434" rel="stylesheet">
    <link href="/0.9.2/css/font-awesome.min.css?1532541434" rel="stylesheet">
    <link href="/0.9.2/css/hybrid.css?1532541434" rel="stylesheet">
    <link href="/0.9.2/css/featherlight.min.css?1532541434" rel="stylesheet">
    <link href="/0.9.2/css/perfect-scrollbar.min.css?1532541434" rel="stylesheet">
    <link href="/0.9.2/css/auto-complete.css?1532541434" rel="stylesheet">
    <link href="/0.9.2/css/theme.css?1532541434" rel="stylesheet">
    <link href="/0.9.2/css/hugo-theme.css?1532541434" rel="stylesheet">
    
      <link href="/0.9.2/css/theme-fission.css?1532541434" rel="stylesheet">
    

    <script src="/0.9.2/js/jquery-2.x.min.js?1532541434"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/0.9.2/installation/upgrade/upgrade-from-v0.3/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://fission.io/">
  <img src=/0.9.2/images/fission-logo.png>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="/0.9.2/js/lunr.min.js?1532541434"></script>
<script type="text/javascript" src="/0.9.2/js/auto-complete.js?1532541434"></script>
<script type="text/javascript">
    
        var baseurl = '\/0.9.2';
    
</script>
<script type="text/javascript" src="/0.9.2/js/search.js?1532541434"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/0.9.2/installation/" title="Installation Guide" class="dd-item 
        parent
        
        
        ">
      <a href="/0.9.2/installation/">
          Installation Guide
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/installation/installation/" title="Installation Guide" class="dd-item ">
        <a href="/0.9.2/installation/installation/">
        Installation Guide
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/installation/kubernetessetup/" title="Kubernetes Quick Install" class="dd-item ">
        <a href="/0.9.2/installation/kubernetessetup/">
        Kubernetes Quick Install
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/installation/releasenotes/" title="Release notes" class="dd-item ">
        <a href="/0.9.2/installation/releasenotes/">
        Release notes
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/0.9.2/installation/upgrade/" title="Upgrade" class="dd-item 
        parent
        
        
        ">
      <a href="/0.9.2/installation/upgrade/">
          Upgrade
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/installation/upgrade/upgrade-from-v0.1/" title="Upgrading from v0.1 to v0.2.x" class="dd-item ">
        <a href="/0.9.2/installation/upgrade/upgrade-from-v0.1/">
        Upgrading from v0.1 to v0.2.x
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/installation/upgrade/upgrade-from-v0.3/" title="Upgrading from v0.3 to v0.4.x" class="dd-item active">
        <a href="/0.9.2/installation/upgrade/upgrade-from-v0.3/">
        Upgrading from v0.3 to v0.4.x
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/installation/upgrade/upgrade-from-v0.4/" title="Upgrading from v0.4.x to v0.5.0" class="dd-item ">
        <a href="/0.9.2/installation/upgrade/upgrade-from-v0.4/">
        Upgrading from v0.4.x to v0.5.0
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.9.2/concepts/" title="Fission Concepts" class="dd-item 
        
        
        
        ">
      <a href="/0.9.2/concepts/">
          Fission Concepts
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/concepts/environments/" title="Environments" class="dd-item ">
        <a href="/0.9.2/concepts/environments/">
        Environments
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/concepts/executor/" title="Controlling Function Execution" class="dd-item ">
        <a href="/0.9.2/concepts/executor/">
        Controlling Function Execution
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/concepts/trigger/" title="Trigger" class="dd-item ">
        <a href="/0.9.2/concepts/trigger/">
        Trigger
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/concepts/package/" title="Builder and Packages" class="dd-item ">
        <a href="/0.9.2/concepts/package/">
        Builder and Packages
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.9.2/usage/" title="Using Fission" class="dd-item 
        
        
        
        ">
      <a href="/0.9.2/usage/">
          Using Fission
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/usage/functions/" title="Function" class="dd-item ">
        <a href="/0.9.2/usage/functions/">
        Function
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/usage/environments/" title="Environment" class="dd-item ">
        <a href="/0.9.2/usage/environments/">
        Environment
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/usage/executor/" title="Controlling Function Execution" class="dd-item ">
        <a href="/0.9.2/usage/executor/">
        Controlling Function Execution
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/usage/trigger/" title="Triggers" class="dd-item ">
        <a href="/0.9.2/usage/trigger/">
        Triggers
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/usage/package/" title="Packaging source code" class="dd-item ">
        <a href="/0.9.2/usage/package/">
        Packaging source code
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/usage/access-secret-cfgmap-in-function/" title="Accessing Secrets in Functions" class="dd-item ">
        <a href="/0.9.2/usage/access-secret-cfgmap-in-function/">
        Accessing Secrets in Functions
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.9.2/contributing/" title="Contributing to Fission" class="dd-item 
        
        
        
        ">
      <a href="/0.9.2/contributing/">
          Contributing to Fission
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/contributing/compiling/" title="Compiling Fission" class="dd-item ">
        <a href="/0.9.2/contributing/compiling/">
        Compiling Fission
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.9.2/workflows/" title="Fission Workflows" class="dd-item 
        
        
        
        ">
      <a href="/0.9.2/workflows/">
          Fission Workflows
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/0.9.2/tutorial/" title="Tutorials" class="dd-item 
        
        
        
        ">
      <a href="/0.9.2/tutorial/">
          Tutorials
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/tutorial/enabling-istio-on-fission/" title="Enabling Istio on Fission" class="dd-item ">
        <a href="/0.9.2/tutorial/enabling-istio-on-fission/">
        Enabling Istio on Fission
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/tutorial/ingress-tutorial/" title="Exposing functions with Ingress" class="dd-item ">
        <a href="/0.9.2/tutorial/ingress-tutorial/">
        Exposing functions with Ingress
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/tutorial/java-example/" title="Building Java Functions" class="dd-item ">
        <a href="/0.9.2/tutorial/java-example/">
        Building Java Functions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/0.9.2/tutorial/developer-workflow/" title="Source Code Organization and Your Development Workflow" class="dd-item ">
        <a href="/0.9.2/tutorial/developer-workflow/">
        Source Code Organization and Your Development Workflow
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li class="" role=""> 
                  <a class="padding" href="https://github.com/fission/fission"><i class='fa fa-fw fa-github'></i> Github repo</a>
              </li>
          
              <li class="" role=""> 
                  <a class="padding" href="https://github.com/fission/fission/graphs/contributors"><i class='fa fa-fw fa-bullhorn'></i> Credits</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/fission/docs.fission.io/edit/master/docs/content/installation/upgrade/upgrade-from-v0.3.en.md" target="blank">
                      <i class="fa fa-code-fork"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/0.9.2/'>Fission</a> > <a href='/0.9.2/installation/'>Installation Guide</a> > <a href='/0.9.2/installation/upgrade/'>Upgrade</a> > Upgrading from v0.3 to v0.4.x
          
         
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#how-to-upgrade">How to Upgrade</a>
<ul>
<li><a href="#get-the-new-cli">Get the new CLI</a>
<ul>
<li><a href="#os-x">OS X</a></li>
<li><a href="#linux">Linux</a></li>
<li><a href="#windows">Windows</a></li>
</ul></li>
<li><a href="#get-fission-state-from-v0-3-install">Get Fission state from v0.3 install</a></li>
<li><a href="#upgrade-to-fission-0-4-0">Upgrade to Fission 0.4.0</a></li>
<li><a href="#upgrade-kubernetes-cluster-version">Upgrade Kubernetes cluster version</a></li>
<li><a href="#remove-all-tpr-definition-for-kubernetes-1-7-x">Remove all TPR definition (for Kubernetes 1.7.x)</a></li>
<li><a href="#restore-your-fission-state-into-fission-0-4-0">Restore your Fission state into Fission 0.4.0</a></li>
<li><a href="#verify">Verify</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Upgrading from v0.3 to v0.4.x</h1>
          

        




<h2 id="introduction">Introduction</h2>

<p>Kubernetes ThirdPartyResources (&ldquo;TPR&rdquo;) are replaced by
CustomResourceDefinitions (&ldquo;CRD&rdquo;). TPRs have been deprecated and are
removed in Kubernetes 1.8.</p>

<p>Since Fission stores state in TPRs, we need to migrate this state from
TPRs to CRDs while upgrading.</p>

<p>Follow the instructions below if you&rsquo;re upgrading a Fission 0.2.1 or
0.3.0 cluster to 0.4. If you&rsquo;re using a pre-0.2 Fission cluster, use
the [upgrade guide from 0.1 to 0.2]() and then upgrade to 0.4.0.</p>

<h2 id="how-to-upgrade">How to Upgrade</h2>

<ol>
<li>Get the 0.4.0 CLI</li>
<li>Get the Fission state from v0.3 install</li>
<li>Upgrade to Fission 0.4.0</li>
<li>Upgrade Kubernetes cluster version to 1.7.x or higher</li>
<li>Remove all TPR definition (for Kubernetes 1.7.x)</li>
<li>Restore Fission state into CRDs</li>
</ol>

<h3 id="get-the-new-cli">Get the new CLI</h3>

<h4 id="os-x">OS X</h4>

<pre><code>$ curl -Lo fission https://github.com/fission/fission/releases/download/0.4.0/fission-cli-osx &amp;&amp; chmod +x fission &amp;&amp; sudo mv fission /usr/local/bin/
</code></pre>

<h4 id="linux">Linux</h4>

<pre><code>$ curl -Lo fission https://github.com/fission/fission/releases/download/0.4.0/fission-cli-linux &amp;&amp; chmod +x fission &amp;&amp; sudo mv fission /usr/local/bin/
</code></pre>

<h4 id="windows">Windows</h4>

<p>For Windows, you can use the linux binary on WSL. Or you can download
this windows executable: <a href="https://github.com/fission/fission/releases/download/0.4.0/fission-cli-windows.exe">fission.exe</a></p>

<h3 id="get-fission-state-from-v0-3-install">Get Fission state from v0.3 install</h3>

<pre><code>fission --server &lt;your v0.3 server&gt; tpr2crd dump --file state.json
</code></pre>

<p>You can skip the &ndash;server argument if you have the environment
variable <code>$FISSION_URL</code> set to point at a v0.3 Fission server.</p>

<p>This will create a JSON file with all your fission state in the
current directory.</p>

<h3 id="upgrade-to-fission-0-4-0">Upgrade to Fission 0.4.0</h3>

<p>Upgrade fission with a command similar to this:</p>

<pre><code>helm upgrade fission-all --namespace fission
</code></pre>

<h3 id="upgrade-kubernetes-cluster-version">Upgrade Kubernetes cluster version</h3>

<p>Since CustomResource is only supported on Kubernetes v1.7+ and higher, please make sure
that you upgrade to the right version that supports CustomResource.</p>

<h3 id="remove-all-tpr-definition-for-kubernetes-1-7-x">Remove all TPR definition (for Kubernetes 1.7.x)</h3>

<p>** NOTICE **: This step will remove TPR definition from your kubernetes cluster. Please make sure that you dump all TPRs at the second step!</p>

<p>Though Kubernetes will migrate TPRs to CRDs automatically when TPR definition is deleted if the same name CRD exists. We still need to make sure that there is no resource gets lost during the migration. Also, since we changed the capitalization of some CRDs to CamelCase (e.g. Httptrigger -&gt; HTTPTrigger), we need to recreate those resources by ourselves.</p>

<pre><code>fission tpr2crd delete
</code></pre>

<h3 id="restore-your-fission-state-into-fission-0-4-0">Restore your Fission state into Fission 0.4.0</h3>

<pre><code>fission tpr2crd restore --file state.json
</code></pre>

<p>This commands needs <code>$FISSION_URL</code> set to point to new fission installation.</p>

<p>It uses the file created in the first step.  It doesn&rsquo;t modify state.json.</p>

<p>(Note that you can run this restore on any cluster; it doesn&rsquo;t have the be the same kubernetes
cluster as your old install.)</p>

<h3 id="verify">Verify</h3>

<p>Let&rsquo;s check the migration result, first run following command to check CRD established state.</p>

<pre><code>kubectl get crd -o 'custom-columns=NAME:{.metadata.name},ESTABLISHED:{.status.conditions[?(@.type==&quot;Established&quot;)].status}'
</code></pre>

<p>The output should be like this</p>

<pre><code>NAME                                 ESTABLISHED
environments.fission.io              True
functions.fission.io                 True
httptriggers.fission.io              True
kuberneteswatchtriggers.fission.io   True
messagequeuetriggers.fission.io      True
packages.fission.io                  True
timetriggers.fission.io              True
</code></pre>

<p>And check that CRD resources you expect are there.</p>

<pre><code>COMMAND:
   fission [resource] list

RESOURCES:
    environments
    functions
    httptriggers
    kuberneteswatchtriggers
    messagequeuetriggers
    packages
    timetriggers
</code></pre>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        

        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/0.9.2/js/clipboard.min.js?1532541434"></script>
    <script src="/0.9.2/js/perfect-scrollbar.min.js?1532541434"></script>
    <script src="/0.9.2/js/perfect-scrollbar.jquery.min.js?1532541434"></script>
    <script src="/0.9.2/js/jquery.sticky.js?1532541434"></script>
    <script src="/0.9.2/js/featherlight.min.js?1532541434"></script>
    <script src="/0.9.2/js/html5shiv-printshiv.min.js?1532541434"></script>
    <script src="/0.9.2/js/highlight.pack.js?1532541434"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/0.9.2/js/modernizr.custom.71422.js?1532541434"></script>
    <script src="/0.9.2/js/learn.js?1532541434"></script>
    <script src="/0.9.2/js/hugo-learn.js?1532541434"></script>

    <link href="/0.9.2/mermaid/mermaid.css?1532541434" type="text/css" rel="stylesheet" />
    <script src="/0.9.2/mermaid/mermaid.js?1532541434"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-86980724-1', 'auto');
  ga('send', 'pageview');
</script>

<script type="text/javascript" src="//script.crazyegg.com/pages/scripts/0059/9755.js" async="async"></script>

  </body>
</html>

